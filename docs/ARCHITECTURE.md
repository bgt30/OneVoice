# OneVoice 시스템 아키텍처

OneVoice 프로젝트는 영어 동영상을 한국어로 더빙하는 자동화된 웹 애플리케이션입니다. 이 문서는 시스템의 전반적인 아키텍처와 구성 요소 간의 상호작용을 설명합니다.

## 시스템 구성도

```
┌─────────────┐     ┌──────────────┐     ┌────────────────┐
│  프론트엔드  │────▶│   백엔드 API  │────▶│  작업 관리자   │
└─────────────┘     └──────────────┘     └────────────────┘
                           │                     │
                           ▼                     ▼
                    ┌──────────────┐     ┌────────────────┐
                    │  미디어 처리  │◀───▶│   AI 서비스    │
                    └──────────────┘     └────────────────┘
                           │                     │
                           ▼                     ▼
                    ┌──────────────┐     ┌────────────────┐
                    │ 임시 저장소  │     │  결과 저장소   │
                    └──────────────┘     └────────────────┘
```

## 주요 구성 요소

### 1. 프론트엔드 (React/TypeScript)

사용자 인터페이스를 제공하는 웹 애플리케이션으로, 다음과 같은 주요 기능을 담당합니다:
- 비디오 파일 업로드 및 YouTube URL 입력 인터페이스
- 작업 처리 상태 모니터링 및 진행률 표시
- 결과 비디오 재생 및 다운로드 기능

### 2. 백엔드 API (FastAPI)

RESTful API를 제공하며 다음과 같은 핵심 기능을 담당합니다:
- 비디오 파일 및 YouTube 링크 처리
- 클라이언트 요청 검증 및 라우팅
- 작업 상태 조회 및 결과 제공
- 인증 및 권한 관리 (향후 계획)

### 3. 작업 관리자 (Redis 기반)

비동기 작업을 관리하고 상태를 추적합니다:
- 작업 큐 관리 및 우선순위 처리
- 작업 상태 및 진행률 추적
- 작업 결과 캐싱
- 실패한 작업 재시도 및 오류 관리

### 4. 미디어 처리 모듈

비디오 및 오디오 데이터를 처리하는 핵심 구성 요소:
- 비디오 및 오디오 추출 (FFmpeg)
- YouTube 비디오 다운로드 (yt-dlp)
- 오디오 정규화 및 인코딩
- 최종 비디오 합성 및 포맷 변환

### 5. AI 서비스 모듈

머신러닝 기반 처리를 담당하는 구성 요소:
- 음성 인식 (STT): 오디오에서 텍스트 추출
- 텍스트 번역 (NMT): 영어에서 한국어로 번역
- 음성 합성 (TTS): 한국어 텍스트를 음성으로 변환

## 데이터 흐름

1. **입력 처리**:
   - 사용자가 비디오 파일을 업로드하거나 YouTube URL을 제공
   - 백엔드에서 입력 유효성 검사 후 작업 ID 생성 및 반환

2. **미디어 준비**:
   - 비디오에서 오디오 트랙 추출
   - 오디오 정규화 및 최적화

3. **AI 처리 파이프라인**:
   - STT 처리: 오디오에서 텍스트 추출 및 타임스탬프 정보 보존
   - 번역: 텍스트 번역 수행, 타임스탬프 정보 유지
   - TTS 처리: 번역된 텍스트를 한국어 음성으로 변환

4. **미디어 합성**:
   - 원본 비디오와 합성된 한국어 오디오 결합
   - 최종 비디오 인코딩 및 최적화

5. **결과 제공**:
   - 변환된 비디오 저장 및 식별자 할당
   - 사용자에게 결과물 제공 및 다운로드 링크 생성

## 기술 스택 상세

### 인프라

- **컨테이너화**: Docker, Docker Compose
- **캐싱 및 작업 관리**: Redis
- **저장소**: 로컬 파일 시스템, Google Cloud Storage(옵션)

### 백엔드

- **웹 프레임워크**: FastAPI
- **비동기 처리**: asyncio, Redis 큐
- **미디어 처리**: FFmpeg, yt-dlp
- **AI 서비스**: Google Cloud STT/TTS/Translation API

### 프론트엔드

- **프레임워크**: React, TypeScript
- **UI 라이브러리**: Material-UI
- **상태 관리**: React Context API / Hooks
- **API 통신**: Axios

## 확장성 고려 사항

### 수평적 확장

- 백엔드 API 서버를 로드 밸런서 뒤에 여러 인스턴스로 확장 가능
- 작업 처리 워커를 독립적으로 스케일링하여 처리량 조정
- Redis 클러스터링을 통한 작업 큐 확장

### 수직적 확장

- 리소스 집약적인 비디오 처리를 위한 고성능 워커 노드 추가
- GPU 가속을 활용한 비디오 인코딩 성능 향상
- 메모리 최적화를 통한 대용량 비디오 처리 지원

## 성능 최적화

- **작업 분할**: 대용량 비디오를 처리 가능한 청크로 분할
- **병렬 처리**: 독립적인 작업의 동시 처리를 통한 처리 시간 단축
- **캐싱 전략**: 자주 사용되는 결과 및 중간 데이터 캐싱
- **적응형 처리**: 입력 비디오 특성에 따른 최적의 처리 파이프라인 선택

## 보안 고려 사항

- **입력 검증**: 모든 사용자 입력 데이터의 철저한 검증
- **자원 제한**: 사용자당 처리 시간 및 리소스 사용량 제한
- **안전한 저장**: 민감한 데이터 암호화 및 안전한 저장
- **접근 제어**: API 엔드포인트 보호 및 권한 관리 (계획됨)

## 장애 허용 및 복구

- **자동 재시도**: 일시적인 오류에 대한 자동 재시도 메커니즘
- **무상태 설계**: 서버 장애 시 쉬운 복구를 위한 무상태 아키텍처
- **데이터 백업**: 중요 데이터의 주기적 백업
- **모니터링**: 시스템 상태 및 성능 지표 모니터링

## 미래 확장 계획

- **멀티 언어 지원**: 다양한 언어 조합 지원
- **사용자 계정 및 이력 관리**: 사용자별 작업 이력 및 선호도 저장
- **고급 비디오 처리 옵션**: 자막 추가, 품질 조정 등 추가 기능
- **API 확장**: 타 시스템 통합을 위한 API 확장
- **배치 처리**: 다중 비디오 동시 처리 지원 